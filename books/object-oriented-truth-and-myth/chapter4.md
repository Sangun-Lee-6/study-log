# Ch 4. 역할, 책임, 협력

# 1. 협력

## 📌 요청하고 응답하며 협력하는 사람들

✅ 협력 = 요청/응답으로 연결되는 네트워크

- 문제 해결 과정에서 요청/응답의 연쇄적인 흐름이 발생
- 협력의 시작 : 한 사람이 다른 사람에게 도움을 요청할 때
- 요청을 받은 사람도 일 처리 중 도움이 필요하면 요청을 보낼 수 있음

## 📌 누가 파이를 훔쳤지?

📖 앨리스 이야기 : 파이를 훔친 하트 잭에 대한 법정 모습

- 왕, 모자 장수(증언), 앨리스(구경) 등 많은 객체가 있음
- 모여있는 이유 : 하트 잭을 재판하기 위해

✅ 협력에는 목적이 있음

- 객체지향 세계 : 동일한 목적을 달성하기 위해 협력하는 객체들의 공동체
- 앨리스 이야기에서 객체들은 `하트 잭의 재판`이라는 목적을 달성하기 위해 협력하고 있는 것

## 📌 재판 속의 협력

📖 앨리스 이야기 : 요청/응답의 흐름으로 구성된 협력

- `하트 잭의 재판`이라는 목적을 달성하기 위한 협력
- 요청(왕 → 토끼) : 증인 부르기, 요청(토끼 → 모자장수) : 입장하기, 응답(모자장수 → 토끼, 왕) : 입장

✅ 어떤 등장인물이 특정 요청을 받을 수 있는 이유

- 응답할 수 있는 능력이 되므로

✅ 요청과 응답은 협력에 참여하는 객체가 수행할 책임을 정의함

## 📌 책임

✅ 객체의 책임

- 객체가 책임을 갖는 것 ⇒ 객체가 요청에 대해 대답할 수 있거나 행동을 할 의무가 있는 경우

📖 앨리스 이야기 : 토끼의 책임

- 토끼는 목격자 불러오기 요청을 받음
- ∴ 목격자를 불러올 책임이 생김
- 요청은 받은 대상이 요청을 처리할 책임이 있음을 의미

## 📌 책임의 분류

✅ 객체의 책임 = knowing + doing

- 객체의 책임은 객체가 무엇을 아는가와 무엇을 할 수 있는가로 구성

📖 앨리스 이야기 : 토끼의 책임

- knowing : 모자 장수가 목격자라는 것
- doing : 모자 장수에게 증인석 입장 요청

✅ 명확하고 적절한 책임이 객체지향 설계의 품질을 결정함

✅ 책임은 객체의 공용 인터페이스(public interface)

- knowing : 객체가 외부에 제공할 수 있는 데이터
- doing : 객체가 외부에 제공할 수 있는 행동

## 📌 책임과 메세지

✅ 협력 안에서 객체는 요청을 받았을 때만 주어진 책임을 수행함

✅ 메세지 전송(message-send)

- 객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것
- ∴ 협력은 메세지를 통해 이루어짐
- 메세지는 협력을 위해 한 객체가 다른 객체에게 접근할 수 있는 유일한 방법

✅ 송신자와 수신자

- 송신자 : 메세지를 전송해서 협력을 요청하는 객체
- 수신자 : 메세지를 받아 요청을 처리하는 객체

✅ 메세지로 협력에 참여하는 두 객체의 관계를 표현

- 송신자 : 수신자가 이해할 수 있는 메세지를 전송 가능한 객체
- 수신자 : 송신자가 보낸 메세지에 대해 책임 수행 가능한 객체

⚠️ 주의할 점

- 책임은 메세지보다 상위 개념
- 하나의 책임은 여러 메세지로 구현됨

✅ 객체지향 설계에서 책임과 메세지

- 협력을 위해 객체의 책임과 어떤 메세지를 수신할 것인지 결정하는 것부터 시작
- 그 이후에 이를 구현할 클래스와 메서드를 생각

# 2. 역할

## 📌 책임의 집합이 의미하는 것

✅ 책임의 집합은 역할을 의미함

- 협력에서 객체가 어떤 책임의 집합을 수행하는 것은 역할을 의미
- ex. 재판에서 모자 장수의 책임은 `입장하기, 증언하기` → 따라서 역할은 `증인`

✅ 역할이 중요한 이유

- 역할은 재사용 가능하고 유연한 객체지향 설계의 중요한 요소이므로

## 📌 판사와 증인

📖 앨리스 이야기 : 모자 장수, 요리사, 앨리스가 증인으로 참석하는 장면

- 각 재판 과정은 증인이 누구인지 달라도 그 흐름이 유사함

## 📌 역할이 답이다

📖 앨리스 이야기 : 3개의 재판 과정

- 즉, 3개의 협력
- 역할을 사용하면 3개의 재판을 하나의 협력으로 추상화 가능

✅ 역할은 협력 안에서 다른 객체로 대체할 수 있음을 나타냄

- 이때 역할을 대체할 수 있는 객체는 동일한 메세지를 이해할 수 있는 객체

✅ 메세지는 책임을 의미함

- ∴ 같은 역할을 수행한다는 것 = 해당 객체들이 협력에서 같은 책임의 집합을 수행한다는 것

✅ 같은 역할을 수행하는 객체들은 같은 책임을 수행할 수 있음

- ∵ 같은 메세지를 수신할 수 있으므로

✅ 역할을 사용하면 협력을 추상화할 수 있음

- 인지 과부하 ↓, 재사용성 ↑, 단순성 ↑, 유연성 ↑

## 📌 협력의 추상화

✅ 역할은 협력을 추상화 가능 → 그러면 협력이 단순해짐

- ∵ 한 역할에 여러 객체가 들어올 수 있으므로

## 📌 대체 가능성

✅ 역할은 다른 객체에 의해 대체 가능함을 의미

- 대체 가능하려면 해당 역할의 행동을 수행할 수 있어야함
- 즉, 모든 책임을 동일하게 수행할 수 있어야함

✅ 대체 가능한 객체는 보통 주어진 책임 외에 다른 책임을 더 수행할 수 있음

- ∴ 객체의 타입과 역할 사이에는 일반화/특수화 관계가 성립
- 일반화 : 역할 ↔ 특수화 : 객체의 타입

# 3. 객체의 모양을 결정하는 협력

## 📌 흔한 오류

1️⃣ 객체는 데이터를 저장하기 위해 존재하지 않음

- 데이터는 객체의 행동에 필요한 재료일 뿐
- 객체는 행동을 수행하며 협력에 참여하기 위해 존재함

2️⃣ 객체지향에서 정적인 클래스가 중요한게 아님

- 협력에 참여하는 동적인 객체가 중요
- 클래스는 객체를 표현하고 생성하기 위한, 언어가 제공하는 구현 메커니즘일 뿐
- 객체지향의 핵심은 클래스를 어떻게 구현할 것인가가 아니라 객체가 협력 안에서 어떤 책임과 역할을 수행할 것인지 결정하는 것

✅ 실제로 동작하는 애플리케이션을 설계하기 위해서 객체 인스턴스 자체가 아니라 협력을 중심으로 생각해야함

- ex. 재판 애플리케이션을 만들 때, 토끼 인스턴스를 모델링할 경우 흰색 털, 2개의 토끼 귀 등 생각
- 협력 안에서 역할, 책임을 생각 : 증인 부르기, 판사의 메세지 수신하기

## 📌 협력을 따라 흐르는 객체의 책임

올바른 객체를 설계하기 위해 먼저 협력을 설계해야함

협력 설계란 협력에 참여하는 객체의 요청과 응답 흐름을 결정하는 것

이렇게 결정된 요청, 응답은 객체가 협력에 참여하기 위해 수행할 책임이 됨

객체에 책임을 할당하고 나면 책임은 객체가 외부에 제공할 행동이 됨

행동을 결정한 후에 행동을 수행하는 데 필요한 데이터를 고민해야함

그리고 나서 객체가 협력에 참여하기 위한 행동과 데이터가 결정되면, 이를 구현하기 위한 클래스를 생각

(이 과정은 1, 2, 3 처럼 단계별로 정리. 개발자 입장에서 어떻게 단계적으로 생각해야하는지 정리)

자율적이면서 협력적인 객체를 만드는 방법, 순서

협력을 먼저 생각해서 협력적으로 만든 후에, 협력 안에서 객체를 충분히 자율적으로 만드는 것

✅ 올바른 객체 설계를 위한 6단계 프로세스

1. 협력 설계 : 협력에 참여하는 객체의 요청/응답 흐름을 결정

2. 책임 정의 : 요청/응답을 책임으로 정의

3. 행동 정의 : 객체가 외부에 제공할 행동을 결정 → 즉, 객체가 어떤 메세지를 수신할 수 있는가

4. 데이터 결정 : 행동을 수행하기 위한 내부 상태 정의

5. 클래스 도출 : 행동, 상태를 가진 객체를 구현할 클래스 설계

6. 구현 : 클래스와 메서드 구현

✅ 자율적이면서 협력적인 객체를 만드는 방법

- 협력을 먼저 생각해서 협력적으로 객체를 만든 후 → 협력 안에서 객체를 자율적으로 만들기

# 4. 객체지향 설계 기법

✅ 역할, 책임, 협력 관점에서 애플리케이션을 설계하는 3가지 기법

1. 책임 주도 설계(Responsibility Driven Design)

2. 디자인 패턴(Design Pattern)

3. 테스트 주도 개발(Test Driven Development)

## 📌 책임 주도 설계

✅ 객체지향 설계에서 앱의 기능을 구현하는 과정

1. 협력을 생각하고

2. 협력에 필요한 역할, 책임을 식별한 후

3. 이를 수행할 객체를 식별하는 과정

✅ 객체지향 설계의 핵심은 올바른 책임을 올바른 객체에 할당하는 것

✅ 책임 주도 설계는 객체의 책임을 중심으로 시스템을 구축하는 설계 방법

1. 앱의 기능은 책임으로 분할되고

2. 각 책임은 이를 수행할 객체에게 할당됨

3. 주어진 책임을 수행하면서 다른 객체와 협력

✅ 책임 주도 설계는 객체의 상태가 아니라 객체의 책임과 상호작용에 집중함

- 그러면 시스템은 협력적이면서 자율적인 객체들로 이루어짐

✅ 책임 주도 설계 절차

1. 시스템이 사용자에게 제공해야하는 기능 파악(즉, 시스템의 책임)

2. 시스템 책임을 더 작은 책임으로 분할

3. 분할된 책임을 수행할 역할, 객체를 찾아 책임 할당

4. 객체가 책임을 수행하면서 다른 객체가 필요한 경우, 이를 수행할 적절한 객체를 찾음

5. 해당 객체에게 책임을 할당해서 두 객체가 협력하게 됨

## 📌 디자인 패턴

✅ 책임 주도 설계는 객체의 역할, 책임, 협력을 생각하기 위한 절차를 제시함

- 반면 디자인 패턴은 책임 주도 설계의 결과를 표현
- 디자인 패턴은 모범이 되는 설계임

✅ 디자인 패턴은 반복적으로 발생하는 문제와 문제에 대한 해법

- 패턴은 특정 상황에서 어떤 설계가 왜 더 효과적인지 이유를 설명함

✅ 특정 문제에 적용 가능한 디자인 패턴을 알고 있다면, 책임 주도 설계의 절차를 따르지 않고도 빠르게 객체의 역할, 책임, 협력을 파악할 수 있음

## 📌 테스트 주도 개발

✅ 테스트 주도 개발은 객체가 이미 존재한다고 가정하고 객체에게 어떤 메세지를 전송할 것인지 생각

- 이때 역할, 책임, 협력 관점에서 객체를 보지 않을 경우 의미 없음

✅ 테스트 주도 개발은 테스트를 작성하는 것이 아님

- 책임을 수행할 객체가 메세지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드로 작성하는 것

✅ 테스트 주도 개발은 설계 경험과 디자인 패턴에 대한 지식이 없다면 그 효과를 누리기 어려움